<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <title>UFO Mission Control (SIMULATION)</title>
    <style>
        /* ‡∏™‡πÑ‡∏ï‡∏•‡πå Cyberpunk ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏õ‡∏±‡∏î UFO */
        body {
            font-family: 'Courier New', monospace;
            text-align: center;
            background-color: #000;
            color: #0f0;
            margin: 0;
            padding: 10px;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        h1 {
            text-shadow: 0 0 10px #0f0;
            margin: 10px 0;
            font-size: 1.5em;
            letter-spacing: 2px;
            animation: pulse 2s infinite;
        }

        /* ‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏†‡∏≤‡∏û‡∏Å‡∏•‡πâ‡∏≠‡∏á */
        .camera-box {
            width: 90%;
            max-width: 320px;
            height: 240px;
            background: #050505;
            border: 2px solid #333;
            border-radius: 10px;
            margin-bottom: 10px;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 10px rgba(0, 255, 0, 0.1);
        }

        .camera-active {
            border-color: #0f0;
            box-shadow: 0 0 15px rgba(0, 255, 0, 0.3);
        }

        /* ‡∏†‡∏≤‡∏û‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏à‡∏≤‡∏Å‡∏Å‡∏•‡πâ‡∏≠‡∏á (img tag) */
        #camStream {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: none;
            z-index: 3;
            position: relative;
            /* ‡πÄ‡∏≠‡∏≤ transition ‡∏≠‡∏≠‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ Pan ‡πÑ‡∏î‡πâ‡∏•‡∏∑‡πà‡∏ô‡πÑ‡∏´‡∏•‡πÑ‡∏°‡πà‡∏´‡∏ô‡πà‡∏ß‡∏á */
            /* transition: transform 0.1s linear; */
            transform-origin: center center;
        }

        .cam-overlay {
            position: absolute;
            top: 10px;
            left: 10px;
            background: red;
            color: white;
            padding: 2px 5px;
            font-size: 10px;
            border-radius: 3px;
            display: none;
            animation: blink 1s infinite;
            z-index: 10;
        }

        /* ‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå‡πÅ‡∏ü‡∏•‡∏ä‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ (‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà) */
        .flash-effect {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: white;
            opacity: 0;
            pointer-events: none;
            z-index: 50;
        }

        @keyframes shutter-snap {
            0% {
                opacity: 0.8;
            }

            100% {
                opacity: 0;
            }
        }

        /* ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ã‡∏π‡∏° */
        .zoom-display {
            position: absolute;
            top: 10px;
            right: 10px;
            color: #0f0;
            font-weight: bold;
            font-size: 14px;
            background: rgba(0, 0, 0, 0.5);
            padding: 2px 6px;
            border-radius: 4px;
            display: none;
            /* ‡∏ã‡πà‡∏≠‡∏ô‡∏Å‡πà‡∏≠‡∏ô */
            z-index: 15;
            border: 1px solid #0f0;
        }

        /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Slider Bar (Scale Bar) */
        .zoom-slider-container {
            position: absolute;
            bottom: 15px;
            left: 5%;
            width: 90%;
            z-index: 20;
            display: none;
            /* ‡∏ã‡πà‡∏≠‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á */
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0.6);
            padding: 5px;
            border-radius: 15px;
            border: 1px solid #333;
        }

        input[type=range].zoom-slider {
            -webkit-appearance: none;
            /* Override default CSS styles */
            width: 100%;
            background: transparent;
        }

        input[type=range].zoom-slider:focus {
            outline: none;
        }

        /* Track (‡∏£‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô) */
        input[type=range].zoom-slider::-webkit-slider-runnable-track {
            width: 100%;
            height: 6px;
            cursor: pointer;
            background: rgba(0, 50, 0, 0.8);
            border-radius: 3px;
            border: 1px solid #0f0;
        }

        /* Thumb (‡∏´‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô) */
        input[type=range].zoom-slider::-webkit-slider-thumb {
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: #000;
            border: 2px solid #0f0;
            box-shadow: 0 0 5px #0f0;
            cursor: pointer;
            -webkit-appearance: none;
            margin-top: -8px;
            /* ‡∏à‡∏±‡∏î‡∏Å‡∏∂‡πà‡∏á‡∏Å‡∏•‡∏≤‡∏á‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á */
        }

        .cam-message {
            color: #333;
            font-size: 1.2em;
            position: absolute;
            z-index: 5;
            text-align: center;
        }

        /* ‡∏ä‡πà‡∏≠‡∏á‡πÉ‡∏™‡πà URL ‡∏Å‡∏•‡πâ‡∏≠‡∏á */
        .cam-config {
            margin-bottom: 15px;
            display: flex;
            gap: 5px;
            width: 90%;
            max-width: 320px;
        }

        .cam-input {
            flex-grow: 1;
            background: #111;
            border: 1px solid #333;
            color: #0f0;
            padding: 5px;
            border-radius: 5px;
            font-family: monospace;
        }

        /* ‡∏õ‡∏∏‡πà‡∏° Test */
        .test-btn {
            background: #333;
            color: #fff;
            border: 1px solid #555;
            border-radius: 5px;
            cursor: pointer;
        }

        /* ‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏†‡∏≤‡∏û‡∏ã‡πà‡∏≤‡πÜ (Static Noise) */
        .static-noise {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: url('https://media.giphy.com/media/oEI9uBYSzLpBK/giphy.gif');
            background-size: cover;
            opacity: 0.1;
            display: none;
            pointer-events: none;
            z-index: 2;
        }

        /* ‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• */
        .data-box {
            border: 1px dashed #0f0;
            padding: 10px;
            margin-bottom: 15px;
            width: 90%;
            max-width: 320px;
            border-radius: 10px;
            background: #050505;
            box-shadow: 0 0 15px rgba(0, 255, 0, 0.2);
        }

        .telemetry-label {
            font-size: 0.8em;
            color: #888;
        }

        .telemetry-value {
            font-size: 1.2em;
            font-weight: bold;
            text-shadow: 0 0 5px #0f0;
        }

        /* ‡πÅ‡∏ú‡∏á‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏° */
        .control-panel {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            width: 100%;
            max-width: 280px;
        }

        .empty {
            visibility: hidden;
        }

        /* ‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏î */
        .btn {
            background-color: #111;
            border: 2px solid #0f0;
            color: #0f0;
            padding: 15px 0;
            font-size: 24px;
            border-radius: 50%;
            cursor: pointer;
            touch-action: manipulation;
            box-shadow: 0 0 10px #0f0 inset;
            transition: all 0.1s;
            user-select: none;
            -webkit-user-select: none;
        }

        .btn:active {
            background-color: #0f0;
            color: #000;
            transform: scale(0.95);
            box-shadow: 0 0 20px #0f0;
        }

        /* ‡∏õ‡∏∏‡πà‡∏° STOP */
        .stop {
            border-color: #f00;
            color: #f00;
            box-shadow: 0 0 10px #f00 inset;
            border-radius: 15px;
            font-size: 16px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .stop:active {
            background-color: #f00;
            color: #fff;
            box-shadow: 0 0 20px #f00;
        }

        /* ‡∏õ‡∏∏‡πà‡∏°‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏© (Auto / Cam) */
        .func-btn {
            border-color: #0ff;
            color: #0ff;
            box-shadow: 0 0 10px #0ff inset;
            border-radius: 10px;
            font-size: 14px;
        }

        .func-active {
            background-color: #0ff;
            color: #000;
            box-shadow: 0 0 20px #0ff;
        }

        /* ‡∏õ‡∏∏‡πà‡∏° Snap (‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà) */
        .snap-btn {
            border-color: #ff0;
            color: #ff0;
            box-shadow: 0 0 10px #ff0 inset;
            border-radius: 15px;
            font-size: 14px;
            font-weight: bold;
        }

        .snap-btn:active {
            background-color: #ff0;
            color: #000;
            box-shadow: 0 0 20px #ff0;
        }

        @keyframes pulse {
            0% {
                text-shadow: 0 0 10px #0f0;
                opacity: 1;
            }

            50% {
                text-shadow: 0 0 20px #0f0;
                opacity: 0.8;
            }

            100% {
                text-shadow: 0 0 10px #0f0;
                opacity: 1;
            }
        }

        @keyframes blink {
            0% {
                opacity: 1;
            }

            50% {
                opacity: 0;
            }

            100% {
                opacity: 1;
            }
        }

        .wifi-status {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 12px;
            color: #0f0;
        }
    </style>
</head>

<body>

    <div class="wifi-status">üì∂ Connected (SIM)</div>

    <h1>üëΩ UFO LINK üëΩ</h1>

    <!-- ‡∏™‡πà‡∏ß‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏Å‡∏•‡πâ‡∏≠‡∏á (Camera Feed) -->
    <div id="camBox" class="camera-box">
        <div id="camRec" class="cam-overlay">LIVE</div>
        <!-- ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ã‡∏π‡∏° -->
        <div id="zoomDisplay" class="zoom-display">ZOOM x1.3</div>

        <!-- ‡πÅ‡∏ü‡∏•‡∏ä‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ -->
        <div id="cameraFlash" class="flash-effect"></div>

        <!-- ‡πÉ‡∏ä‡πâ‡∏ß‡∏¥‡∏ò‡∏µ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (‡πÄ‡∏≠‡∏≤ onerror/onload ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏Å‡πâ‡∏ö‡∏±‡πä‡∏Å) -->
        <!-- ‡πÉ‡∏™‡πà src ‡πÄ‡∏õ‡πá‡∏ô base64 pixel ‡∏ß‡πà‡∏≤‡∏á‡πÜ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏Ç‡∏∂‡πâ‡∏ô broken image -->
        <img id="camStream" src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=" alt="Camera Feed">

        <!-- ‡∏™‡πÄ‡∏Å‡∏•‡∏ö‡∏≤‡∏£‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ã‡∏π‡∏° (Zoom Slider) -->
        <div id="zoomControls" class="zoom-slider-container">
            <input type="range" id="zoomSlider" class="zoom-slider" min="1.3" max="50" step="0.1" value="1.3"
                oninput="slideZoom(this.value)">
        </div>

        <div id="camStatic" class="static-noise"></div>
        <div id="camMsg" class="cam-message">CAMERA OFFLINE</div>
    </div>

    <!-- ‡∏ä‡πà‡∏≠‡∏á‡πÉ‡∏™‡πà URL ‡∏Ç‡∏≠‡∏á‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö -->
    <div class="cam-config">
        <!-- ‡πÉ‡∏™‡πà‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô -->
        <input type="text" id="camUrlInput" class="cam-input" placeholder="‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡∏†‡∏≤‡∏û ‡∏´‡∏£‡∏∑‡∏≠ URL"
            value="https://firebasestorage.googleapis.com/v0/b/susanonline-9ccbb.firebasestorage.app/o/fireo%2Fufo_cam_view.jpg?alt=media&token=0306c0d9-06ca-4844-8114-f07952d4abce">
        <button class="test-btn" onclick="loadDemoImage()">TEST</button>
    </div>

    <div class="data-box">
        <div>
            <span class="telemetry-label">HARVESTED ENERGY</span><br>
            <span id="volts" class="telemetry-value">0.00</span> <span style="font-size:1em">kV</span>
        </div>
        <div style="margin-top: 10px; border-top: 1px solid #333; padding-top: 5px;">
            <span class="telemetry-label">STATUS</span><br>
            <span id="status" class="telemetry-value" style="color: #fff; font-size: 1em;">READY</span>
        </div>
    </div>

    <div class="control-panel">
        <!-- ‡πÅ‡∏ñ‡∏ß‡∏ö‡∏ô -->
        <button id="btnCam" class="btn func-btn" onclick="toggleCamera()">üì∑ CAM</button>
        <button class="btn" onmousedown="simMove('FORWARD')" onmouseup="simStop()" ontouchstart="simMove('FORWARD')"
            ontouchend="simStop()">‚ñ≤</button>
        <button id="btnAuto" class="btn func-btn" onclick="toggleAuto()">ü§ñ AUTO</button>

        <!-- ‡πÅ‡∏ñ‡∏ß‡∏Å‡∏•‡∏≤‡∏á -->
        <button class="btn" onmousedown="simMove('LEFT')" onmouseup="simStop()" ontouchstart="simMove('LEFT')"
            ontouchend="simStop()">‚óÄ</button>
        <button class="btn stop" onclick="simStop()">STOP</button>
        <button class="btn" onmousedown="simMove('RIGHT')" onmouseup="simStop()" ontouchstart="simMove('RIGHT')"
            ontouchend="simStop()">‚ñ∂</button>

        <!-- ‡πÅ‡∏ñ‡∏ß‡∏•‡πà‡∏≤‡∏á -->
        <button class="btn snap-btn" onclick="takeSnapshot()">üì∏ SNAP</button>
        <button class="btn" onmousedown="simMove('BACKWARD')" onmouseup="simStop()" ontouchstart="simMove('BACKWARD')"
            ontouchend="simStop()">‚ñº</button>
        <div class="empty"></div>
    </div>

    <script>
        // --- ‡∏™‡πà‡∏ß‡∏ô‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô (MOCK LOGIC) ---

        const ONLINE_URL = "https://firebasestorage.googleapis.com/v0/b/susanonline-9ccbb.firebasestorage.app/o/fireo%2Fufo_cam_view.jpg?alt=media&token=0306c0d9-06ca-4844-8114-f07952d4abce";
        const LOCAL_URL = "http://127.0.0.1:5500/ufo_cam_view.jpg";

        let isAuto = false;
        let isCamOn = false;
        let voltage = 12.5;
        let currentZoom = 1.3; // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ó‡∏µ‡πà 1.3x ‡∏ï‡∏≤‡∏°‡∏Ñ‡∏≥‡∏Ç‡∏≠

        // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Ç‡∏µ‡∏î‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ã‡∏π‡∏°
        const MIN_ZOOM = 1.3;
        const MAX_ZOOM = 50.0;

        // ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Pan (‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏†‡∏≤‡∏û)
        let panX = 0;
        let panY = 0;
        let panInterval = null;

        // --- ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Event Handler ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏•‡πâ‡∏≠‡∏á ---
        window.onload = function () {
            let img = document.getElementById('camStream');

            img.onerror = function () {
                handleCamError(this);
            };

            img.onload = function () {
                // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏Å‡πà‡∏≠‡∏ô‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô Pixel ‡∏ß‡πà‡∏≤‡∏á‡πÜ ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏õ‡∏•‡πà‡∏≤ (‡∏ñ‡πâ‡∏≤‡πÉ‡∏ä‡πà ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£)
                if (this.src.startsWith("data:image")) return;
                handleCamSuccess(this);
            };

            // ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
            toggleCamera();
        };

        // 1. ‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü
        setInterval(function () {
            let noise = (Math.random() - 0.5) * 2.0;
            voltage = 20.0 + noise;
            document.getElementById('volts').innerText = voltage.toFixed(2);

            let wifiIcon = document.querySelector('.wifi-status');
            wifiIcon.style.opacity = wifiIcon.style.opacity === '0.5' ? '1' : '0.5';
        }, 800);

        // 2. ‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á + Pan ‡∏Å‡∏•‡πâ‡∏≠‡∏á
        function simMove(direction) {
            if (isAuto) return;
            updateStatus("THRUST: " + direction, "#0ff");
            console.log("CMD: " + direction);

            // ‡∏ñ‡πâ‡∏≤‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡∏≠‡∏¢‡∏π‡πà ‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏¥‡πà‡∏° Pan ‡∏†‡∏≤‡∏û
            if (isCamOn) {
                // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå Loop ‡πÄ‡∏Å‡πà‡∏≤‡∏Å‡πà‡∏≠‡∏ô‡∏Å‡∏±‡∏ô‡∏ã‡πâ‡∏≠‡∏ô
                if (panInterval) clearInterval(panInterval);

                // ‡πÄ‡∏£‡∏¥‡πà‡∏° Loop ‡∏Ç‡∏¢‡∏±‡∏ö‡∏†‡∏≤‡∏û (50ms ‡∏ï‡πà‡∏≠‡∏Ñ‡∏£‡∏±‡πâ‡∏á)
                panInterval = setInterval(() => {
                    // ‡∏õ‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß Pan ‡∏ï‡∏≤‡∏°‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ã‡∏π‡∏° (‡∏¢‡∏¥‡πà‡∏á‡∏ã‡∏π‡∏°‡πÄ‡∏¢‡∏≠‡∏∞ ‡∏¢‡∏¥‡πà‡∏á‡∏ï‡πâ‡∏≠‡∏á Pan ‡πÄ‡∏£‡πá‡∏ß‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏Ç‡∏¢‡∏±‡∏ö‡πÄ‡∏ó‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏°)
                    let step = 10 * (currentZoom / 2);
                    if (step < 5) step = 5; // ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥

                    if (direction === 'FORWARD') panY += step; // ‡∏Å‡∏î‡∏Ç‡∏∂‡πâ‡∏ô -> ‡∏†‡∏≤‡∏û‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏•‡∏á (‡∏°‡∏≠‡∏á‡∏Ç‡∏∂‡πâ‡∏ô)
                    if (direction === 'BACKWARD') panY -= step; // ‡∏Å‡∏î‡∏•‡∏á -> ‡∏†‡∏≤‡∏û‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô (‡∏°‡∏≠‡∏á‡∏•‡∏á)
                    if (direction === 'LEFT') panX += step; // ‡∏Å‡∏î‡∏ã‡πâ‡∏≤‡∏¢ -> ‡∏†‡∏≤‡∏û‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏Ç‡∏ß‡∏≤ (‡∏°‡∏≠‡∏á‡∏ã‡πâ‡∏≤‡∏¢)
                    if (direction === 'RIGHT') panX -= step; // ‡∏Å‡∏î‡∏Ç‡∏ß‡∏≤ -> ‡∏†‡∏≤‡∏û‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ã‡πâ‡∏≤‡∏¢ (‡∏°‡∏≠‡∏á‡∏Ç‡∏ß‡∏≤)

                    updateCamTransform();
                }, 50);
            }
        }

        function simStop() {
            if (isAuto) return;
            updateStatus("HOVERING", "#fff");

            // ‡∏´‡∏¢‡∏∏‡∏î Pan ‡∏†‡∏≤‡∏û
            if (panInterval) {
                clearInterval(panInterval);
                panInterval = null;
            }
        }

        // 3. ‡∏à‡∏≥‡∏•‡∏≠‡∏á‡πÇ‡∏´‡∏°‡∏î Auto Pilot
        function toggleAuto() {
            isAuto = !isAuto;
            let btn = document.getElementById('btnAuto');

            if (isAuto) {
                btn.classList.add('func-active');
                updateStatus("‚ö†Ô∏è AUTO PILOT", "orange");
                simulateAI();
            } else {
                btn.classList.remove('func-active');
                updateStatus("MANUAL CONTROL", "#fff");
                clearTimeout(aiTimer);
            }
        }

        // 4. ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Å‡∏•‡πâ‡∏≠‡∏á (Camera Handling)
        function toggleCamera() {
            isCamOn = !isCamOn;
            let btn = document.getElementById('btnCam');
            let box = document.getElementById('camBox');
            let rec = document.getElementById('camRec');
            let msg = document.getElementById('camMsg');
            let noise = document.getElementById('camStatic');
            let stream = document.getElementById('camStream');
            let zoomCtrls = document.getElementById('zoomControls');
            let zoomDisplay = document.getElementById('zoomDisplay');
            let inputUrl = document.getElementById('camUrlInput').value;

            if (isCamOn) {
                btn.classList.add('func-active');
                box.classList.add('camera-active');
                rec.style.display = 'block';
                msg.innerText = "CONNECTING...";
                msg.style.color = "#333";

                // Reset Flag ‡∏Å‡∏≤‡∏£‡∏•‡∏≠‡∏á Fallback
                stream.dataset.fallbackTried = "";

                // ‡∏•‡∏≠‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏†‡∏≤‡∏û‡∏à‡∏≤‡∏Å URL ‡∏ó‡∏µ‡πà‡πÉ‡∏™‡πà (‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Ñ‡∏∑‡∏≠ Online)
                stream.src = inputUrl;

                // ‡∏ñ‡πâ‡∏≤‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ Noise ‡∏à‡∏∞‡∏ö‡∏±‡∏á‡πÑ‡∏ß‡πâ
                noise.style.display = 'block';

                // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Zoom/Pan ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
                updateCamTransform();

            } else {
                btn.classList.remove('func-active');
                box.classList.remove('camera-active');
                rec.style.display = 'none';
                noise.style.display = 'none';
                stream.style.display = 'none';
                stream.src = ""; // ‡∏´‡∏¢‡∏∏‡∏î‡πÇ‡∏´‡∏•‡∏î
                msg.style.color = "#333";
                msg.innerText = "CAMERA OFFLINE";
                zoomCtrls.style.display = 'none';
                zoomDisplay.style.display = 'none';
                resetZoom();
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ã‡∏π‡∏°‡∏î‡πâ‡∏ß‡∏¢ Slider (Slide Zoom Logic)
        function slideZoom(val) {
            if (!isCamOn) return;
            currentZoom = parseFloat(val);

            // ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ã‡∏π‡∏° (‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡πÑ‡∏ß‡πâ)
            if (currentZoom < MIN_ZOOM) currentZoom = MIN_ZOOM;
            if (currentZoom > MAX_ZOOM) currentZoom = MAX_ZOOM;

            updateCamTransform();
        }

        function resetZoom() {
            currentZoom = MIN_ZOOM; // ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô 1.3
            panX = 0;
            panY = 0;

            // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ñ‡πà‡∏≤ Slider ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏à‡∏∏‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢
            let slider = document.getElementById('zoomSlider');
            if (slider) slider.value = MIN_ZOOM;

            updateCamTransform();
        }

        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÅ‡∏•‡∏∞‡∏Ç‡∏ô‡∏≤‡∏î‡∏†‡∏≤‡∏û (‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏Ç‡∏≠‡∏ö‡∏à‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡πÄ‡∏´‡πá‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á)
        function updateCamTransform() {
            let img = document.getElementById('camStream');
            let box = document.getElementById('camBox');
            let zoomText = document.getElementById('zoomDisplay');

            if (!img || !box) return;

            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ç‡∏≠‡∏ö‡πÄ‡∏Ç‡∏ï‡∏ó‡∏µ‡πà‡∏¢‡∏≠‡∏°‡πÉ‡∏´‡πâ Pan ‡πÑ‡∏î‡πâ (Boundaries)
            // ‡∏™‡∏π‡∏ï‡∏£: (‡∏Ç‡∏ô‡∏≤‡∏î‡∏£‡∏π‡∏õ‡∏´‡∏•‡∏±‡∏á‡∏ã‡∏π‡∏° - ‡∏Ç‡∏ô‡∏≤‡∏î‡∏Å‡∏•‡πà‡∏≠‡∏á) / 2
            // ‡πÄ‡∏û‡∏£‡∏≤‡∏∞ transform-origin ‡∏Ñ‡∏∑‡∏≠ center center
            let maxPanX = (box.offsetWidth * currentZoom - box.offsetWidth) / 2;
            let maxPanY = (box.offsetHeight * currentZoom - box.offsetHeight) / 2;

            // ‡∏•‡πá‡∏≠‡∏Å‡∏Ñ‡πà‡∏≤ Pan ‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏¥‡∏ô‡∏Ç‡∏≠‡∏ö‡πÄ‡∏Ç‡∏ï (Clamp)
            // ‡∏ñ‡πâ‡∏≤‡∏ã‡∏π‡∏°‡∏ô‡πâ‡∏≠‡∏¢ (‡πÄ‡∏ä‡πà‡∏ô 1.0) ‡∏Ñ‡πà‡∏≤ maxPan ‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô 0 ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Ç‡∏¢‡∏±‡∏ö‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ (‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á)
            if (panX > maxPanX) panX = maxPanX;
            if (panX < -maxPanX) panX = -maxPanX;
            if (panY > maxPanY) panY = maxPanY;
            if (panY < -maxPanY) panY = -maxPanY;

            img.style.transform = `translate(${panX}px, ${panY}px) scale(${currentZoom})`;

            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ã‡∏π‡∏°
            if (zoomText) {
                zoomText.innerText = "ZOOM x" + currentZoom.toFixed(1);
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û (Snapshot)
        function takeSnapshot() {
            if (!isCamOn) return;

            // 1. ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå‡πÅ‡∏ü‡∏•‡∏ä
            let flash = document.getElementById('cameraFlash');
            flash.style.animation = 'none'; // reset
            flash.offsetHeight; // trigger reflow
            flash.style.animation = 'shutter-snap 0.2s linear';

            // 2. ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î
            let img = document.getElementById('camStream');
            let imgUrl = img.src;

            // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡∏ï‡∏≤‡∏°‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
            let now = new Date();
            let timestamp = now.toISOString().replace(/[:.]/g, '-');
            let filename = `UFO_SNAP_${timestamp}.jpg`;

            // ‡∏™‡∏£‡πâ‡∏≤‡∏á Link ‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î
            let a = document.createElement('a');
            a.href = imgUrl;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);

            updateStatus("IMAGE CAPTURED!", "#ff0");
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏†‡∏≤‡∏û‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠ (Error Handling + Smart Fallback)
        function handleCamError(img) {
            if (!isCamOn) return;

            // ‡∏ñ‡πâ‡∏≤ URL ‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏á ‡∏Ñ‡∏∑‡∏≠ URL ‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå (‡∏´‡∏£‡∏∑‡∏≠‡∏°‡∏µ‡∏Ñ‡∏≥‡∏ß‡πà‡∏≤ firebasestorage) ‡πÅ‡∏•‡∏∞‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏¢‡∏•‡∏≠‡∏á Fallback
            if (img.src.includes("firebasestorage") && !img.dataset.fallbackTried) {
                console.log("Online source failed. Switching to Local backup...");
                img.src = LOCAL_URL;
                img.dataset.fallbackTried = "true"; // ‡πÅ‡∏õ‡∏∞‡∏õ‡πâ‡∏≤‡∏¢‡∏ß‡πà‡∏≤‡∏•‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏±‡∏ô Loop

                // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ä‡πà‡∏≠‡∏á input ‡πÉ‡∏´‡πâ‡∏£‡∏π‡πâ‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô local
                document.getElementById('camUrlInput').value = LOCAL_URL;

                // ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
                let msg = document.getElementById('camMsg');
                msg.innerText = "RETRYING LOCAL...";
                return;
            }

            // ‡∏ñ‡πâ‡∏≤‡∏•‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß‡∏¢‡∏±‡∏á‡∏û‡∏±‡∏á ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏õ‡πá‡∏ô URL ‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á Error
            img.style.display = 'none';
            document.getElementById('camStatic').style.display = 'block'; // ‡πÇ‡∏ä‡∏ß‡πå Noise
            document.getElementById('zoomControls').style.display = 'none';
            document.getElementById('zoomDisplay').style.display = 'none';
            let msg = document.getElementById('camMsg');
            msg.innerHTML = '<span style="color:red">CONNECTION FAILED</span><br><span style="font-size:0.6em; color:#888">Offline Mode</span>';
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏†‡∏≤‡∏û‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
        function handleCamSuccess(img) {
            if (!isCamOn) return;
            document.getElementById('camMsg').innerText = '';
            img.style.display = 'block';
            document.getElementById('camStatic').style.display = 'none'; // ‡∏ã‡πà‡∏≠‡∏ô Noise
            document.getElementById('zoomControls').style.display = 'flex'; // ‡πÇ‡∏ä‡∏ß‡πå Slider
            document.getElementById('zoomDisplay').style.display = 'block'; // ‡πÇ‡∏ä‡∏ß‡πå‡πÄ‡∏•‡∏Ç‡∏ã‡∏π‡∏°
            updateCamTransform(); // ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡∏†‡∏≤‡∏û‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏ó‡∏µ‡πà‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏õ‡∏∏‡πà‡∏° TEST (‡πÇ‡∏´‡∏•‡∏î‡∏†‡∏≤‡∏û‡∏à‡∏≤‡∏Å‡πÄ‡∏ô‡πá‡∏ï)
        function loadDemoImage() {
            document.getElementById('camUrlInput').value = "https://media.giphy.com/media/3o7aD2saalBwwftBIY/giphy.gif";
            // ‡∏ñ‡πâ‡∏≤‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß ‡πÉ‡∏´‡πâ‡∏õ‡∏¥‡∏î‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏µ‡πÇ‡∏´‡∏•‡∏î
            if (isCamOn) toggleCamera();
            setTimeout(toggleCamera, 100);
        }

        function updateStatus(text, color) {
            let el = document.getElementById('status');
            el.innerText = text;
            el.style.color = color;
            el.style.textShadow = "0 0 10px " + color;
        }

        let aiTimer;
        function simulateAI() {
            if (!isAuto) return;
            const actions = ["CORRECTING..", "STABILIZING", "SEEKING..", "HOVERING"];
            const randomAction = actions[Math.floor(Math.random() * actions.length)];
            updateStatus("ü§ñ " + randomAction, "orange");
            aiTimer = setTimeout(simulateAI, 2000);
        }
    </script>
</body>

</html>